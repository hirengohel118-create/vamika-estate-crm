<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vamika Estate CRM Pro</title>
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root { --p-color: #3b82f6; }
    body { background: #020617; color: #f8fafc; font-family: sans-serif; padding-bottom: 80px; }
    .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.08); }
    .card-grad { background: linear-gradient(145deg, #0f172a 0%, #020617 100%); border: 1px solid rgba(255,255,255,0.05); border-radius: 1.5rem; margin-bottom: 12px; }
    input, select, textarea { background: rgba(0,0,0,0.3) !important; border: 1px solid #1e293b !important; color: white !important; padding: 12px; border-radius: 12px; width: 100%; margin-bottom: 8px; outline: none; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 15px; }
    .stat-box { cursor: pointer; transition: 0.3s; }
    .stat-box:active { scale: 0.95; }
  </style>
</head>
<body>
  <header class="p-4 glass sticky top-0 z-50 flex justify-between items-center">
    <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center font-bold text-xl">V</div>
        <div>
            <h1 class="font-bold text-white text-lg">Vamika Estate</h1>
            <p class="text-[10px] text-blue-400 font-bold">HIREN GOHEL â€¢ 7046869462</p>
        </div>
    </div>
  </header>

  <main class="p-4 max-w-5xl mx-auto">
    <section id="tab-home" class="tab-content active">
        <div class="grid grid-cols-2 gap-3 mb-6" id="dash-stats">
            </div>
        <h3 class="font-bold mb-3 text-blue-400"><i class="fa-solid fa-clock-rotate-left"></i> Recent Activity</h3>
        <div id="recent-leads" class="space-y-3"></div>
    </section>

    <section id="tab-leads" class="tab-content">
        <div class="flex gap-2 mb-4">
            <input type="text" id="leadSearch" oninput="renderLeads()" placeholder="Search leads..." class="flex-1">
            <button onclick="openLeadModal()" class="bg-blue-600 px-4 rounded-xl font-bold">+ Add</button>
        </div>
        <div id="leadList" class="space-y-3"></div>
    </section>

    <section id="tab-projects" class="tab-content">
        <div class="flex justify-between items-center mb-4">
            <h2 class="font-bold text-xl">Projects</h2>
            <button onclick="openProjectModal()" class="bg-blue-600 px-4 py-2 rounded-lg font-bold text-sm">+ New Project</button>
        </div>
        <div id="projectList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </section>

    <section id="tab-settings" class="tab-content">
        <div class="glass p-6 rounded-3xl space-y-6">
            <div>
                <p class="font-bold mb-3 text-blue-400">Theme Presets</p>
                <div class="flex gap-4">
                    <button onclick="changeTheme('#3b82f6')" class="w-10 h-10 rounded-full bg-blue-500 border-2 border-white"></button>
                    <button onclick="changeTheme('#10b981')" class="w-10 h-10 rounded-full bg-emerald-500"></button>
                    <button onclick="changeTheme('#000000')" class="w-10 h-10 rounded-full bg-slate-900 border border-slate-700"></button>
                </div>
            </div>
            <button onclick="downloadBackup()" class="w-full text-left p-4 glass rounded-xl"><i class="fa-solid fa-database mr-2 text-blue-500"></i> Download JSON Backup</button>
        </div>
    </section>
  </main>

  <div id="projectModal" class="modal">
    <div class="glass bg-[#1e293b] w-full max-w-xl p-6 rounded-[2rem] max-h-[90vh] overflow-y-auto shadow-2xl">
        <h3 id="pModalTitle" class="text-xl font-bold mb-4 text-center italic tracking-tight">PROJECT DETAILS</h3>
        <input id="pName" placeholder="Project Name *">
        <input id="pLoc" placeholder="Location">
        <div class="grid grid-cols-2 gap-2">
            <select id="pPossMonth"><option value="">Month</option><option>Jan</option><option>Feb</option><option>Mar</option><option>Apr</option><option>May</option><option>Jun</option><option>Jul</option><option>Aug</option><option>Sep</option><option>Oct</option><option>Nov</option><option>Dec</option></select>
            <select id="pPossYear"><option value="">Year</option><option>2024</option><option>2025</option><option>2026</option><option>2027</option><option>2028</option></select>
        </div>
        <input id="pBoxPrice" placeholder="Approx Box Price (e.g. 75L - 1.2Cr)" class="text-green-400 font-bold">
        <textarea id="pBhkSize" placeholder="BHK & Sizes (New line for each)"></textarea>
        <textarea id="pDesc" placeholder="Description / Highlights"></textarea>
        <div class="flex gap-2 mt-4">
            <button onclick="closeProjectModal()" class="flex-1 p-3 glass rounded-xl">Cancel</button>
            <button onclick="saveProject()" class="flex-1 p-3 bg-blue-600 rounded-xl font-bold">Save Details</button>
        </div>
    </div>
  </div>

  <div id="leadModal" class="modal">
    <div class="glass bg-[#1e293b] w-full max-w-lg p-6 rounded-[2rem]">
        <h3 class="font-bold text-xl mb-4">Add Lead Inquiry</h3>
        <input id="lName" placeholder="Name *">
        <input id="lPhone" placeholder="Mobile *">
        <select id="lFor"><option>For Sale</option><option>For Rental</option></select>
        <textarea id="lReq" placeholder="Requirement (e.g. 3BHK South Bopal)"></textarea>
        <input type="date" id="lFollow" class="text-white">
        <div class="flex gap-2 mt-4">
            <button onclick="closeLeadModal()" class="flex-1 p-3 glass rounded-xl">Cancel</button>
            <button onclick="saveLead()" class="flex-1 p-3 bg-blue-600 rounded-xl font-bold">Save Lead</button>
        </div>
    </div>
  </div>

  <nav class="fixed bottom-0 left-0 right-0 glass flex justify-around p-4 z-50">
    <i class="fa-solid fa-house text-xl cursor-pointer" onclick="switchTab('home')"></i>
    <i class="fa-solid fa-users text-xl cursor-pointer" onclick="switchTab('leads')"></i>
    <i class="fa-solid fa-building text-xl cursor-pointer" onclick="switchTab('projects')"></i>
    <i class="fa-solid fa-gear text-xl cursor-pointer" onclick="switchTab('settings')"></i>
  </nav>

  <script>
    let projects = JSON.parse(localStorage.getItem('ve_projects') || '[]');
    let leads = JSON.parse(localStorage.getItem('ve_leads') || '[]');
    let editIdx = null;
    let currentFilter = 'all';

    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        updateStats();
    }

    // DASHBOARD ACTIONS
    function filterDashboard(type) {
        currentFilter = type;
        switchTab('leads');
        renderLeads();
    }

    function updateStats() {
        const today = new Date().toISOString().split('T')[0];
        const dash = document.getElementById('dash-stats');
        dash.innerHTML = `
            <div class="glass p-4 rounded-2xl stat-box border-l-4 border-blue-500" onclick="filterDashboard('all')">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Total Leads</p>
                <h2 class="text-2xl font-bold">${leads.length}</h2>
            </div>
            <div class="glass p-4 rounded-2xl stat-box border-l-4 border-amber-500" onclick="filterDashboard('follow')">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Follow-ups Today</p>
                <h2 class="text-2xl font-bold text-amber-500">${leads.filter(l => l.follow === today).length}</h2>
            </div>
            <div class="glass p-4 rounded-2xl stat-box border-l-4 border-emerald-500" onclick="filterDashboard('rental')">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Rental</p>
                <h2 class="text-2xl font-bold text-emerald-500">${leads.filter(l => l.for === 'For Rental').length}</h2>
            </div>
        `;
    }

    // PROJECT LOGIC
    function openProjectModal(idx = null) {
        editIdx = idx;
        document.getElementById('projectModal').style.display = 'flex';
        if(idx !== null) {
            const p = projects[idx];
            document.getElementById('pName').value = p.name;
            document.getElementById('pLoc').value = p.location;
            document.getElementById('pPossMonth').value = p.month || '';
            document.getElementById('pPossYear').value = p.year || '';
            document.getElementById('pBoxPrice').value = p.price || '';
            document.getElementById('pBhkSize').value = p.bhkSize;
            document.getElementById('pDesc').value = p.desc;
        } else {
            document.querySelectorAll('#projectModal input, #projectModal select, #projectModal textarea').forEach(i => i.value = '');
        }
    }

    function closeProjectModal() { document.getElementById('projectModal').style.display = 'none'; }

    function saveProject() {
        const p = {
            name: document.getElementById('pName').value,
            location: document.getElementById('pLoc').value,
            month: document.getElementById('pPossMonth').value,
            year: document.getElementById('pPossYear').value,
            price: document.getElementById('pBoxPrice').value,
            bhkSize: document.getElementById('pBhkSize').value,
            desc: document.getElementById('pDesc').value
        };
        if(!p.name) return alert("Name is required!");
        if(editIdx === null) projects.unshift(p); else projects[editIdx] = p;
        localStorage.setItem('ve_projects', JSON.stringify(projects));
        closeProjectModal(); renderProjects();
    }

    function renderProjects() {
        const list = document.getElementById('projectList');
        list.innerHTML = projects.map((p, i) => `
            <div class="card-grad p-5 relative" onclick="shareProject(${i})">
                <div class="flex justify-between items-start">
                    <div><h3 class="font-bold text-blue-400 text-lg uppercase">${p.name}</h3><p class="text-[10px] text-slate-500">${p.location}</p></div>
                    <div class="flex gap-3 text-slate-600">
                        <i class="fa-solid fa-pen" onclick="event.stopPropagation(); openProjectModal(${i})"></i>
                        <i class="fa-solid fa-trash text-red-900" onclick="event.stopPropagation(); deleteProject(${i})"></i>
                    </div>
                </div>
                <div class="mt-4 flex justify-between items-end">
                    <span class="text-[10px] font-bold bg-blue-500/10 text-blue-300 px-2 py-1 rounded">Possession: ${p.month} ${p.year}</span>
                    <span class="text-green-400 font-bold">â‚¹ ${p.price || 'N/A'}</span>
                </div>
            </div>`).join('');
    }

    function shareProject(i) {
        const p = projects[i];
        const msg = `ðŸ¢ *${p.name.toUpperCase()}*\nðŸ“ ${p.location}\n\nðŸ”‘ *Possession:* ${p.month} ${p.year}\nðŸ’° *Approx Price:* ${p.price}\n\nðŸ“ *BHK & Size:*\n${p.bhkSize}\n\nâœ¨ *Highlights:*\n${p.desc}\n\nRegards,\n*Vamika Estate (Hiren Gohel)*`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
    }

    // LEAD LOGIC
    function openLeadModal() { document.getElementById('leadModal').style.display = 'flex'; }
    function closeLeadModal() { document.getElementById('leadModal').style.display = 'none'; }
    function saveLead() {
        const l = { name: document.getElementById('lName').value, phone: document.getElementById('lPhone').value, for: document.getElementById('lFor').value, req: document.getElementById('lReq').value, follow: document.getElementById('lFollow').value };
        leads.unshift(l); localStorage.setItem('ve_leads', JSON.stringify(leads));
        closeLeadModal(); renderLeads(); updateStats();
    }

    function renderLeads() {
        const list = document.getElementById('leadList');
        let data = leads;
        if(currentFilter === 'rental') data = leads.filter(l => l.for === 'For Rental');
        if(currentFilter === 'follow') { const today = new Date().toISOString().split('T')[0]; data = leads.filter(l => l.follow === today); }
        
        list.innerHTML = data.map((l, i) => `
            <div class="card-grad p-4 flex justify-between items-center">
                <div><h4 class="font-bold text-white">${l.name}</h4><p class="text-xs text-slate-400">${l.phone} â€¢ ${l.for}</p></div>
                <button onclick="window.open('tel:${l.phone}')" class="bg-green-600/20 text-green-400 p-3 rounded-xl"><i class="fa-solid fa-phone"></i></button>
            </div>`).join('');
        currentFilter = 'all';
    }

    function changeTheme(color) { document.documentElement.style.setProperty('--p-color', color); }
    function downloadBackup() {
        const blob = new Blob([JSON.stringify({projects, leads})], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'Vamika_Backup.json'; a.click();
    }

    function deleteProject(i) { if(confirm('Delete?')) { projects.splice(i,1); localStorage.setItem('ve_projects', JSON.stringify(projects)); renderProjects(); }}
    
    document.addEventListener('DOMContentLoaded', () => { renderProjects(); renderLeads(); updateStats(); });
  </script>
</body>
</html>
